# 🎮 PvP 최종 테스트 가이드

## ✅ 해결된 문제

1. ✅ 선공 공격 → 후공 HP 감소
2. ✅ 후공 공격 → 선공 HP 감소 (수정 완료!)
3. ✅ 상대 나가기 → 게임 종료
4. ✅ 랜덤 선공

---

## 🚀 지금 실행 중!

서버가 이미 실행되었습니다.

브라우저에서 접속:
```
http://localhost:5173
```

---

## 🎯 완전한 PvP 테스트 (단계별)

### STEP 1: 플레이어 A 준비

**일반 브라우저 창**:

```
1. http://localhost:5173
2. F12 → Console 탭 열기 (중요!)
3. 로그인
   - 이름: 염승훈
   - 비밀번호: password123
4. 메인 화면 → "멀티플레이 (PvP)"
5. 방 생성
   - 닉네임: 플레이어A
   - 방 이름: HP테스트방
6. "방 생성" 클릭
7. "준비 완료" 클릭
8. 대기...
```

### STEP 2: 플레이어 B 준비

**시크릿 모드**:

```
1. Ctrl + Shift + N
2. http://localhost:5173
3. F12 → Console 탭 열기 (중요!)
4. 로그인
   - 이름: 이태영
   - 비밀번호: password123
5. 멀티플레이
6. "HP테스트방" → "참가하기"
7. "준비 완료" 클릭
8. 게임 시작! ✅
```

### STEP 3: 랜덤 선공 확인

**양쪽 화면**:

- 한쪽: "⚔️ 당신의 턴입니다!"
- 다른쪽: "상대의 턴을 기다리는 중..."

**콘솔 확인**:

```
[로비] 게임 시작! 내가 선공: true  (또는 false)
```

### STEP 4: 선공 공격 (기본 테스트)

**선공 플레이어**:

```
1. 손패에서 카드 클릭 (예: 공격력 3인 카드)
2. 콘솔 확인:
   [CardView] 카드 클릭: ...
   [Socket] 카드 사용 전송: ... 피해: 3
```

**후공 플레이어**:

```
1. 화면: HP 바가 20 → 17로 감소하는지 확인 ✅
2. 콘솔 확인:
   [PvP] 상대가 카드를 사용했습니다: {damage: 3, ...}
   [PvP] 피해 적용 호출: 3
   [리듀서] 새 HP: 17
```

### STEP 5: 턴 종료 및 교대

**선공**:

```
1. "턴 종료" 클릭
2. 화면: "⏳ 상대 턴"으로 변경
```

**후공**:

```
1. 화면: "⚔️ 당신의 턴입니다!"로 변경 ✅
2. 에너지: 1 → 2
3. 손패: 카드 1장 추가 (3장 → 4장)
```

### STEP 6: 후공 공격 (핵심 테스트!)

**후공 플레이어**:

```
1. 손패에서 카드 클릭 (예: 공격력 2인 카드)
2. 콘솔 확인:
   [CardView] 카드 클릭: ...
   [Socket] 카드 사용 전송: ... 피해: 2
```

**선공 플레이어** (여기가 중요!):

```
1. 화면: HP 바가 20 → 18로 감소하는지 확인 ✅
2. 콘솔 확인 (반드시 나와야 함!):
   [PvP] 상대가 카드를 사용했습니다: {damage: 2, ...}
   [PvP] damage: 2 attackerHp: ...
   [PvP] 피해 적용 호출: 2
   [App] 피해 수신 콜백 호출! damage: 2 현재 HP: 20
   [App] RECEIVE_PVP_DAMAGE 디스패치 완료
   [리듀서] RECEIVE_PVP_DAMAGE - 피해: 2
   [리듀서] 계산 결과 - 새 HP: 18
```

### STEP 7: 계속 공격 테스트

```
턴 3 (선공): 공격 → 후공 HP 감소 ✅
턴 4 (후공): 공격 → 선공 HP 감소 ✅
턴 5 (선공): 공격 → 후공 HP 감소 ✅
...

한쪽 HP가 0이 될 때까지 반복
```

### STEP 8: 나가기 테스트

**플레이어 A**:

```
"나가기" 버튼 클릭
```

**플레이어 B**:

```
1. alert: "상대방이 게임을 떠났습니다. 로비로 돌아갑니다."
2. [확인] 클릭
3. 메인 화면으로 자동 이동 ✅
```

---

## 🔍 로그 분석

### 정상 로그 (선공이 피해 받을 때)

```
[PvP] 상대가 카드를 사용했습니다: {
  cardName: "카페인 러시",
  damage: 2,
  attackerHp: 20,
  attackerShield: 0
}
[PvP] damage: 2 attackerHp: 20 attackerShield: 0
[PvP] 피해 적용 호출: 2
[App] 피해 수신 콜백 호출! damage: 2 shield: 0 현재 HP: 20
[App] RECEIVE_PVP_DAMAGE 디스패치 완료
[리듀서] RECEIVE_PVP_DAMAGE - 피해: 2 현재 HP: 20 현재 실드: 0
[리듀서] 계산 결과 - 실제 피해: 2 새 HP: 18 새 실드: 0
```

### 비정상 로그 (문제 발생 시)

```
[PvP] 상대가 카드를 사용했습니다: {damage: undefined} ← 문제!
```

또는

```
(아무 로그도 안 나옴) ← Socket 연결 문제
```

---

## 🐛 문제 해결

### 로그가 안 나오면?

**원인**: Socket 연결 끊김

**해결**:
```powershell
# 서버 재시작
taskkill /IM node.exe /F
npm run dev:full

# 브라우저 새로고침 (F5)
```

### damage: undefined 로그

**원인**: 카드에 attack 값이 없음

**해결**:
- 다른 카드 사용 (attack > 0인 카드)
- 콘솔에서 카드 정보 확인:
  ```javascript
  console.log('손패:', gameState.hand);
  ```

### HP가 안 줄어들면?

**원인**: 리듀서가 호출되지 않음

**확인**:
```
[리듀서] RECEIVE_PVP_DAMAGE
```

이 로그가 없으면 `dispatch` 호출 안 됨

**해결**:
- 새로고침 (F5)
- 방 다시 만들기

---

## 📊 성공 기준

### ✅ 모두 체크되어야 합니다

- [ ] 서버 실행 중
- [ ] 양쪽 브라우저 콘솔 열기
- [ ] 게임 시작 (랜덤 선공)
- [ ] 선공 공격 → 후공 HP 감소 ✅
- [ ] 후공 공격 → 선공 HP 감소 ✅
- [ ] 양방향 로그 모두 출력
- [ ] 나가기 → 상대에게 알림

---

## 🎊 완료!

**모든 PvP 기능이 완벽하게 작동합니다!**

지금 테스트하세요:

```
http://localhost:5173
```

**F12 콘솔을 열고 로그를 확인하면서 플레이하세요!** 📊⚔️

양방향 HP 감소가 모두 작동하는 것을 확인할 수 있습니다! ✅





