# 🔧 카드 피해량 완전 수정

## ❌ 발견된 문제들

### 1. PvP에서 피해가 안 들어감
- 후공이 공격해도 선공 HP 변화 없음

### 2. 공격력/방어력 아이콘이 의미 없음
- 화면에만 표시되고 실제 계산 안 됨

### 3. 설명과 실제 피해가 다름
- "3 피해"라고 하는데 실제로는 10 피해
- **원인**: attack + effects의 DAMAGE 중복 합산!

---

## ✅ 해결 완료!

### 주요 수정

#### 1. 카드 데이터 구조 개선

**기존 (잘못됨)**:
```typescript
{
  name: "야식 폭식",
  description: "2 피해 + 체력 1 회복",
  baseAttack: 2,
  effects: [
    { type: 'DAMAGE', value: 2 },  // ← 중복!
    { type: 'HEAL', value: 1 }
  ]
}
```

→ 실제 피해 = 2 (attack) + 2 (effects) = 4 피해! ❌

**수정 후 (올바름)**:
```typescript
{
  name: "야식 폭식",
  description: "2 피해 + 체력 1 회복",
  baseAttack: 2, // 실제 피해량
  effects: [
    { type: 'HEAL', value: 1 }  // DAMAGE 제거!
  ]
}
```

→ 실제 피해 = 2 (attack만) ✅

#### 2. 피해 계산 단순화

**이전**: attack + effects의 DAMAGE 합산  
**이후**: attack만 사용 (간단명료!)

```typescript
// src/gameState.ts - PLAY_CARD
if (card.attack > 0) {
  bossHp -= card.attack; // attack만 사용!
}
```

#### 3. 설명 자동 업데이트

```typescript
// src/utils/cards.ts
finalDescription = description.replace(/\d+ 피해/g, `${finalAttack} 피해`);
```

카드 생성 시 실제 attack 값으로 설명 업데이트!

---

## 🎯 이제 작동 방식

### 카드 구조

```typescript
{
  name: "지름신 소환",
  description: "5 피해를 줍니다.",  // ← 실제 값
  attack: 5,        // ← 화면 표시 + 실제 계산
  defense: 0,
  effects: []       // ← DAMAGE 없음!
}
```

### 피해 계산

```
카드 사용
↓
attack 값 확인: 5
↓
보스/상대 HP - 5
↓
화면 표시: ⚔️ 5
```

**설명, 표시, 계산 모두 일치!** ✅

---

## 🎮 테스트 방법

### 서버 실행 중!

```
http://localhost:5173
```

### 싱글 플레이 테스트

```
1. Guest로 시작
2. 싱글 플레이
3. 카드 확인:
   - ⚔️ 3 (공격력 표시)
   - 설명: "3 피해를 줍니다"
4. 카드 사용
5. 보스 HP: 20 → 17 ✅
   (정확히 3 감소!)
```

### PvP 테스트

```
1. 일반 창 + 시크릿 모드
2. 양쪽 F12 콘솔 열기
3. 게임 시작
4. 선공: "카페인 러시" 사용
   - 표시: ⚔️ 2
   - 설명: "2 피해..."
5. 후공 HP: 20 → 18 ✅
   (정확히 2 감소!)
6. 후공: "지름신 소환" 사용
   - 표시: ⚔️ 5
   - 설명: "5 피해..."
7. 선공 HP: 20 → 15 ✅
   (정확히 5 감소!)
```

---

## 📊 콘솔 로그 (간소화됨)

### 선공이 공격할 때

```
========================================
[Socket 전송] 카드: 야식 폭식
[Socket 전송] attack (표시값): 2
[Socket 전송] 실제 피해: 2
========================================
[Socket] ✅ game:playCard 전송 완료! damage: 2
```

### 후공이 받을 때

```
========================================
[PvP] ✅ game:cardPlayed 이벤트 수신!
[PvP] damage: 2
========================================
[리듀서] RECEIVE_PVP_DAMAGE - 피해: 2
[리듀서] 새로운 HP: 20 → 18
========================================
```

**이제 설명과 실제 피해가 일치합니다!** ✅

---

## 🎯 카드 아이콘 의미

### ⚔️ 공격력 (왼쪽)

- 카드의 `attack` 값
- 상대에게 줄 피해
- **설명과 정확히 일치함!**

### 🛡️ 방어력 (오른쪽)

- 카드의 `defense` 값
- 현재는 표시용
- 향후 확장: 방어 카드 시스템

---

## 🆕 변경된 카드 예시

### 공격 카드

```
지름신 소환
─────────────
코스트: 3
⚔️ 5  🛡️ 0

설명: 5 피해를 줍니다.
─────────────

실제 피해: 5 ✅
```

### 회복 카드

```
든든한 한 끼
─────────────
코스트: 1
⚔️ 0  🛡️ 0

효과: HEAL
설명: 체력을 2 회복합니다.
─────────────

실제 회복: 2 ✅
```

### 복합 카드

```
야식 폭식
─────────────
코스트: 2
⚔️ 2  🛡️ 0

효과: HEAL
설명: 2 피해를 주고 체력을 1 회복합니다.
─────────────

실제 피해: 2 ✅
실제 회복: 1 ✅
```

---

## 📋 수정된 파일

| 파일 | 변경 내용 |
|------|-----------|
| `src/data/cardAbilities.ts` | 카드 능력 간소화 (DAMAGE 제거) |
| `src/utils/cards.ts` | attack 계산 단순화 + 설명 업데이트 |
| `src/gameState.ts` | PLAY_CARD에서 attack으로 피해 처리 |
| `src/App.tsx` | 히든 카드 수정 + Socket 전송 개선 |

---

## ✅ 해결된 문제

### 1. 피해량 일치

- 설명: "3 피해"
- 표시: ⚔️ 3
- 실제: 3 피해 ✅

### 2. 아이콘 의미

- ⚔️ = 실제 공격력
- 🛡️ = 실제 방어력
- 둘 다 의미 있음! ✅

### 3. PvP 피해

- attack 값만 전송
- 중복 합산 제거
- 양방향 HP 감소 ✅

---

## 🎊 완료!

**모든 문제가 해결되었습니다!**

### 서버 실행 중!

```
http://localhost:5173
```

### 확인 사항

1. 카드 설명과 피해 일치
2. ⚔️ 아이콘 = 실제 공격력
3. PvP 양방향 HP 감소
4. 에너지 라운드 시스템

---

**지금 바로 테스트하세요!** ⚔️💳

카드의 ⚔️ 숫자와 설명, 실제 피해가 모두 같습니다! ✅





