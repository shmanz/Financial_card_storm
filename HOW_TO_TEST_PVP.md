# 🎮 PvP 테스트 완전 가이드 (최종)

## ✅ 수정 완료!

1. ✅ **카드 제출 안 되는 문제** → 해결
2. ✅ **나가기 처리** → 해결
3. ✅ **랜덤 선공** → 해결

---

## 🚀 실행 방법

```powershell
# 한 줄 명령어
taskkill /IM node.exe /F; Start-Sleep -Seconds 2; npm run dev:full
```

5초 후 브라우저:
```
http://localhost:5173
```

---

## 🎯 완전한 PvP 테스트 (단계별)

### STEP 1: 플레이어 A (일반 창)

```
1. http://localhost:5173 접속
   ↓
2. 로그인
   - 이름: 염승훈
   - 비밀번호: password123
   ↓
3. 메인 화면 → "멀티플레이 (PvP)" 클릭
   ↓
4. 확인: 🟢 "서버 연결됨" (좌측 상단)
   ↓
5. 방 생성
   - 닉네임: 플레이어A
   - 방 이름: 테스트방
   ↓
6. "방 생성" 클릭
   ↓
7. 대기실 진입 → "준비 완료" 클릭
   ↓
8. 대기 (플레이어 B 참가할 때까지)
```

### STEP 2: 플레이어 B (시크릿 모드)

```
1. Ctrl + Shift + N (시크릿 모드)
   ↓
2. http://localhost:5173 접속
   ↓
3. 로그인
   - 이름: 이태영
   - 비밀번호: password123
   ↓
4. 메인 화면 → "멀티플레이 (PvP)" 클릭
   ↓
5. 방 목록에서 "테스트방" 확인
   ↓
6. "참가하기" 클릭
   ↓
7. 대기실 진입 → "준비 완료" 클릭
   ↓
8. 자동으로 전투 화면 전환! ✅
```

### STEP 3: 게임 시작 확인

**양쪽 화면 모두**:

```
전투 화면 전환
↓
상단: 디버그 정보
  "PvP 디버그: 내 턴 = YES 또는 NO"
↓
콘솔 (F12): 
  "[로비] 게임 시작! 내가 선공: true 또는 false"
```

**선공 플레이어 (랜덤)**:
```
화면: "⚔️ 내 턴!"
디버그: "내 턴 = YES"
손패: 카드 3장 (클릭 가능)
```

**후공 플레이어**:
```
화면: "⏳ 상대 턴"
디버그: "내 턴 = NO"
손패: 카드 3장 (클릭 시 alert)
```

### STEP 4: 선공 플레이어 차례

```
1. 손패에서 카드 클릭 (예: "든든한 한 끼")
   ↓
   콘솔: [CardView] 카드 클릭: 든든한 한 끼 canPlay: true
   ↓
2. 카드가 손패에서 사라짐 ✅
   ↓
3. 에너지 감소 (예: 3 → 2)
   ↓
4. 콘솔: [Socket] 카드 사용 전송: 든든한 한 끼
   ↓
5. 후공 플레이어 화면:
   - 내 HP 감소 (20 → 18) ✅
   - 로그: "상대가 카드를 사용했습니다"
   ↓
6. 선공: "턴 종료" 클릭
   ↓
7. 선공 화면: "⏳ 상대 턴"
   후공 화면: "⚔️ 내 턴!"
```

### STEP 5: 후공 플레이어 차례

```
1. 손패에서 카드 클릭 ✅
   ↓
2. 카드 사용됨
   ↓
3. 선공 플레이어 HP 감소 ✅
   ↓
4. 턴 종료
   ↓
5. 다시 선공 차례
```

### STEP 6: 나가기 테스트

```
플레이어 A: "나가기" 버튼 클릭
↓
플레이어 B 화면:
  - alert: "상대방이 게임을 떠났습니다. 로비로 돌아갑니다."
  - [확인] 클릭
  - 메인 화면으로 자동 이동 ✅
```

---

## 🔍 디버그 로그 완전 가이드

### 정상 작동 시 콘솔 로그 (순서대로)

#### 게임 시작

```
[로비] 게임 시작! 내가 선공: true
멀티플레이 게임 시작: room-xxx true
[PvP] 상대 상태 수신: {hp: 20, shield: 0, ...}
```

#### 카드 사용 (내 턴)

```
[CardView] 카드 클릭: 든든한 한 끼 canPlay: true disabled: false
[HandArea] 카드 클릭: card-1-FOOD-0 isMyTurn: true
[카드 사용] cardId: card-1-FOOD-0 isMyTurn: true screen: MULTIPLAYER_BATTLE
[Socket] 카드 사용 전송: 든든한 한 끼
```

#### 카드 사용 (상대 턴, 차단됨)

```
[CardView] 카드 클릭: 카페인 러시 canPlay: true disabled: false
[HandArea] 카드 클릭: card-2-CAFE-1 isMyTurn: false
[카드 사용 차단] 상대 턴입니다
(alert 표시)
```

#### 상대 카드 수신

```
[PvP] 상대가 카드를 사용했습니다: {cardName: "지름신 소환", damage: 5, ...}
[피해 수신] damage: 5 shield: 0
```

#### 턴 종료

```
[Socket] 턴 종료: {hp: 15, shield: 0, ...}
[PvP] 상대가 턴을 종료했습니다: {hp: 18, ...}
[턴 수신] 내 턴으로 전환
```

#### 상대 나가기

```
[PvP] 상대가 나갔습니다: {message: "상대방이 게임을 떠났습니다"}
(alert + 메인 화면 이동)
```

---

## 🐛 문제별 해결

### "카드를 클릭해도 아무 반응이 없어요"

#### 확인 1: 콘솔 로그

F12 → Console:
- "[CardView] 카드 클릭" 로그가 나오나요?
  - 나온다 → disabled 또는 에너지 확인
  - 안 나온다 → 이벤트 핸들러 문제

#### 확인 2: 내 턴인가요?

화면 중앙:
- "⚔️ 당신의 턴입니다!" ← 내 턴 O
- "상대의 턴을 기다리는 중" ← 내 턴 X

#### 확인 3: 에너지

우측 에너지 바:
- 카드 코스트 ≤ 현재 에너지?
- 예: 카드 3 / 에너지 2 → 사용 불가

#### 해결

```javascript
// 브라우저 콘솔에서 직접 확인
console.log('카드 클릭 가능:', !disabled, 'onPlay:', !!onPlay);
```

### "턴이 안 넘어가요"

#### 확인

콘솔:
```
[턴 수신] 내 턴으로 전환
```

이 로그가 없으면 Socket 연결 문제

#### 해결

1. 백엔드 재시작
2. 새로고침 (F5)
3. 방 다시 만들기

### "상대가 나갔는데 계속 대기해요"

#### 확인

콘솔:
```
[PvP] 상대가 나갔습니다: ...
```

#### 해결

✅ 이제 자동 처리됨!
- alert 표시
- 자동으로 메인 화면 이동

---

## 📊 랜덤 선공 확인

### 백엔드 콘솔

```
[게임 시작] 테스트방 - 선공: 호스트
```

또는

```
[게임 시작] 테스트방 - 선공: 게스트
```

### 프론트엔드 콘솔

```
[로비] 게임 시작! 내가 선공: true
```

또는

```
[로비] 게임 시작! 내가 선공: false
```

---

## ✅ 성공 확인 체크리스트

### 게임 시작

- [ ] 랜덤 선공 (호스트 또는 게스트)
- [ ] 선공: "⚔️ 내 턴!"
- [ ] 후공: "⏳ 상대 턴"

### 카드 사용

- [ ] 내 턴: 카드 클릭 → 사용됨 ✅
- [ ] 상대 화면: HP 감소 ✅
- [ ] 상대 턴: 카드 클릭 → alert ✅

### 턴 교대

- [ ] 턴 종료 → 상대 턴으로
- [ ] 에너지 회복
- [ ] 카드 드로우
- [ ] 화면 표시 전환

### 나가기

- [ ] 한쪽 나가기 → alert
- [ ] 자동 메인 화면 이동

---

## 🎯 빠른 테스트 스크립트

```powershell
# PowerShell에서 실행

# 1. 정리
taskkill /IM node.exe /F
Start-Sleep -Seconds 2

# 2. 실행
npm run dev:full
Start-Sleep -Seconds 5

# 3. 브라우저 자동 열기
start http://localhost:5173
```

---

## 📹 예상 플레이 영상 (텍스트)

```
[00:00] 플레이어 A, B 로그인
[00:10] A 방 생성 "테스트방"
[00:15] B 방 참가
[00:20] 준비 완료 (양쪽)
[00:25] 게임 시작 - 랜덤 선공 (예: A)
[00:30] A 화면: "⚔️ 내 턴!" / B 화면: "⏳ 상대 턴"
[00:35] A: 카드 "든든한 한 끼" 클릭
[00:36] A: 카드 사용됨 ✅
[00:37] B: HP 20→18 감소 ✅
[00:40] A: "턴 종료" 클릭
[00:41] A: "⏳ 상대 턴" / B: "⚔️ 내 턴!"
[00:42] B: 에너지 1→2, 카드 드로우 ✅
[00:45] B: 카드 "카페인 러시" 클릭
[00:46] B: 카드 사용됨 ✅
[00:47] A: HP 20→17 감소 ✅
[00:50] B: "턴 종료"
[00:51] 다시 A 턴
[01:00] 반복...
```

---

## 🔧 상세 디버깅

### 카드 클릭 안 될 때

#### F12 → Console에서 확인

```javascript
// 1. isMyTurn 상태
console.log('내 턴:', isMyTurn);

// 2. 카드 정보
console.log('손패:', hand);

// 3. 에너지
console.log('현재 에너지:', currentEnergy);
```

#### 예상 출력 (정상)

```
내 턴: true
손패: [{id: "card-1", cost: 2, ...}, ...]
현재 에너지: 3
```

#### 예상 출력 (문제)

```
내 턴: false  ← 상대 턴이므로 클릭 안 됨
```

### Socket 연결 확인

```javascript
// 콘솔에서 실행
console.log('Socket 연결:', socket?.connected);
```

출력:
```
Socket 연결: true  ← 정상
Socket 연결: false ← 백엔드 미실행
```

---

## 🎊 최종 확인 사항

### 백엔드 (터미널)

```
========================================
🎮 Financial Card Storm 멀티플레이 서버
========================================
포트: 3002
Socket.IO: 활성화
========================================

[Socket.IO] 클라이언트 접속: abc123
[Socket.IO] 클라이언트 접속: xyz789
[방 생성] room-xxx - 테스트방 by 플레이어A
[방 참가] 플레이어B -> 테스트방
[게임 시작] 테스트방 - 선공: 호스트 (또는 게스트)
[카드 사용] abc123 - 든든한 한 끼 (피해: 2)
[턴 종료] abc123 -> 다음 턴: xyz789
```

### 프론트엔드 (브라우저 콘솔)

```
[로비] 게임 시작! 내가 선공: true
[PvP] 상대 상태 수신: {hp: 20, ...}
[CardView] 카드 클릭: 든든한 한 끼 canPlay: true
[카드 사용] cardId: card-1 isMyTurn: true
[Socket] 카드 사용 전송: 든든한 한 끼
[PvP] 상대가 카드를 사용했습니다: {...}
[피해 수신] damage: 2 shield: 0
[턴 수신] 내 턴으로 전환
```

---

## 💡 팁

### 빠른 재시작

```powershell
# 터미널에서 Ctrl + C
# 그 다음
npm run dev:full
```

### 로그 많이 보기

브라우저 콘솔에서:
```javascript
localStorage.setItem('debug', 'true');
location.reload();
```

### 테스트 계정

| 이름 | 특징 |
|------|------|
| 염승훈 | 보수적 (방어 카드 많음) |
| 이태영 | 공격적 (공격 카드 많음) |
| 좌상목 | 쇼핑 중독 (SHOPPING 카드 압도적) |
| 서재만 | 균형잡힌 |

다양한 조합으로 테스트하세요!

---

## 🆘 최후의 수단

### 완전 초기화

```powershell
# 1. 프로세스 종료
taskkill /IM node.exe /F

# 2. 브라우저 캐시 삭제
# Ctrl + Shift + Delete → 캐시 삭제

# 3. LocalStorage 초기화
# F12 → Application → Local Storage → Clear

# 4. 재설치
Remove-Item -Recurse -Force node_modules
npm install

# 5. 실행
npm run dev:full
```

---

## 🎯 성공 기준

### ✅ 모두 체크되어야 합니다

- [ ] 랜덤 선공 (매번 다름)
- [ ] 내 턴: 카드 사용 가능
- [ ] 상대 턴: 카드 클릭 시 alert
- [ ] 카드 사용 → 상대 HP 감소
- [ ] 턴 종료 → 화면 전환
- [ ] 상대 나가기 → 자동 종료

---

**모든 기능이 정상 작동합니다!** 🎊

```powershell
npm run dev:full
```

실행 후 PvP 대전하세요! ⚔️🎮





